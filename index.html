<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brown Family Guild Hall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Cinzel:wght@400;700&display=swap');
        
        :root {
            --skyrim-bg: #121212;
            --skyrim-card: rgba(25, 25, 25, 0.9);
            --skyrim-accent: #f0ad4e; /* Amber */
            --skyrim-silver: #d1d1d1;
            --skyrim-border: rgba(255, 255, 255, 0.15);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--skyrim-bg);
            color: var(--skyrim-silver);
            background-image: radial-gradient(circle at center, #1e1e1e 0%, #0f0f0f 100%);
        }

        .rpg-title { 
            font-family: 'Cinzel', serif; 
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .skyrim-border-bottom {
            border-bottom: 1px solid var(--skyrim-border);
            position: relative;
        }

        .skyrim-border-bottom::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--skyrim-silver);
            rotate: 45deg;
            opacity: 0.5;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
        
        .fade-enter { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .char-card { 
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid var(--skyrim-border);
        }

        .char-card:hover { 
            background: rgba(50, 50, 50, 0.8);
            border-color: var(--skyrim-accent);
        }

        .char-card.active {
            border-color: var(--skyrim-accent);
            box-shadow: inset 0 0 15px rgba(240, 173, 78, 0.1);
        }

        .skyrim-progress-bg {
            background: rgba(0, 0, 0, 0.5);
            height: 2px;
            position: relative;
        }

        .skyrim-progress-fill {
            height: 100%;
            background: var(--skyrim-silver);
            box-shadow: 0 0 8px var(--skyrim-silver);
            transition: width 1s ease-out;
        }

        .skyrim-progress-fill.amber {
            background: var(--skyrim-accent);
            box-shadow: 0 0 8px var(--skyrim-accent);
        }

        .architect-card { 
            background: rgba(20, 20, 20, 0.95); 
            border: 1px solid var(--skyrim-accent); 
            backdrop-filter: blur(15px);
        }

        .collect-button {
            background: transparent;
            border: 1px solid var(--skyrim-accent);
            color: var(--skyrim-accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 10px;
            transition: all 0.2s;
        }

        .collect-button:hover {
            background: var(--skyrim-accent);
            color: black;
        }

        input, select {
            background: rgba(0,0,0,0.5) !important;
            border: 1px solid #333 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const TIER_COSTS = {
            Common: 10,
            Unusual: 25,
            Rare: 100,
            Epic: 400,
            Legendary: 1000,
            Mythic: 2500
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const [iconData, setIconData] = useState(null);
            useEffect(() => {
                const checkLucide = () => {
                    if (window.lucide) {
                        const data = window.lucide[name] || (window.lucide.icons ? window.lucide.icons[name] : null);
                        if (data) setIconData(data);
                    } else { setTimeout(checkLucide, 50); }
                };
                checkLucide();
            }, [name]);
            if (!iconData) return <span style={{ width: size, height: size, display: 'inline-block' }} className={className} />;
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {iconData.map(([tag, attrs], i) => React.createElement(tag, { ...attrs, key: i }))}
                </svg>
            );
        };

        const Avatar = ({ id, size = "md" }) => {
            const dim = size === "lg" ? "w-12 h-12" : "w-10 h-10";
            const iconSize = size === "lg" ? 22 : 18;
            const avatars = {
                Eric: { icon: "DraftingCompass", bg: "bg-zinc-800" },
                Catie: { icon: "FlaskConical", bg: "bg-zinc-800" },
                Rory: { icon: "Shield", bg: "bg-zinc-800" },
                Olive: { icon: "Sparkles", bg: "bg-zinc-800" },
                Family: { icon: "Home", bg: "bg-zinc-800" }
            };
            const config = avatars[id] || avatars.Family;
            return (
                <div className={`${dim} rounded-none border border-white/20 ${config.bg} flex items-center justify-center text-white flex-shrink-0 rotate-45`}>
                    <div className="-rotate-45 flex items-center justify-center">
                        <Icon name={config.icon} size={iconSize} className="text-white" />
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isMeetingMode, setIsMeetingMode] = useState(false);
            const [activeFilter, setActiveFilter] = useState('All'); 

            const [familyXP, setFamilyXP] = useState(() => Number(localStorage.getItem('familyXP')) || 0);
            const [familyGold, setFamilyGold] = useState(() => Number(localStorage.getItem('familyGold')) || 0);

            const [members, setMembers] = useState(() => {
                const saved = localStorage.getItem('familyMembers');
                return saved ? JSON.parse(saved) : [
                    { id: 'Eric', name: 'Eric', class: 'Architect', gp: 0, stats: { Fortune: 1, Wisdom: 1, Vitality: 1 }, color: 'blue' },
                    { id: 'Catie', name: 'Catie', class: 'Alchemist', gp: 0, stats: { Harmony: 1, Wisdom: 1, Vitality: 1 }, color: 'purple' },
                    { id: 'Rory', name: 'Rory', class: 'Squire', gp: 0, stats: { Order: 1, Study: 1 }, color: 'orange' },
                    { id: 'Olive', name: 'Olive', class: 'Scout', gp: 0, stats: { Grit: 1, Order: 1 }, color: 'pink' }
                ];
            });

            const rooms = [
                "Kitchen", "Upstairs Bath", "Downstairs Bath", "Laundry Room", 
                "Dining Room", "Living Room", "Eric's Office", "Catie's Office", 
                "Theatre Room", "Rory's Room", "Olive's Room", "Primary Bedroom", "General"
            ];

            const [quests, setQuests] = useState(() => {
                const saved = localStorage.getItem('familyQuests');
                if (saved) return JSON.parse(saved);
                return [
                    { id: 'e1', assignedTo: 'Eric', category: 'Personal', type: 'daily', title: 'Vanguard Training', description: 'Workout 5 days/wk goal', reward: 20, xp: 30, status: 'active' },
                    { id: 'e2', assignedTo: 'Eric', category: 'Personal', type: 'daily', title: 'Clear Mind Protocol', description: 'Mindful consumption', reward: 15, xp: 20, status: 'active' },
                    { id: 'e3', assignedTo: 'Eric', category: 'Personal', type: 'epic', title: 'The Great Archive', description: 'Read 1 book per week', reward: 500, xp: 1000, currentValue: 0, targetValue: 52, unit: 'books', resetsMonthly: false },
                    { id: 'c1', assignedTo: 'Catie', category: 'Personal', type: 'daily', title: 'Alchemist Grind', description: 'Workout 5 days/wk goal', reward: 20, xp: 30, status: 'active' },
                    { id: 'c2', assignedTo: 'Catie', category: 'Personal', type: 'daily', title: 'Spirit Purity', description: 'Mindful consumption', reward: 15, xp: 20, status: 'active' },
                    { id: 'c3', assignedTo: 'Catie', category: 'Personal', type: 'epic', title: 'Metamorphosis', description: 'Lose 25 lbs target', reward: 1500, xp: 3000, currentValue: 0, targetValue: 25, unit: 'lbs', resetsMonthly: false },
                    { id: 'r1', assignedTo: 'Rory', category: 'Personal', type: 'daily', title: 'Toy Commander', description: 'Toys in bins', reward: 5, xp: 10, status: 'active' },
                    { id: 'r2', assignedTo: 'Rory', category: 'Personal', type: 'daily', title: 'Plate Guard', description: 'Clear table', reward: 5, xp: 10, status: 'active' },
                    { id: 'r3', assignedTo: 'Rory', category: 'Personal', type: 'daily', title: 'Socks Matcher', description: 'Laundry help', reward: 5, xp: 10, status: 'active' },
                    { id: 'r4', assignedTo: 'Rory', category: 'Personal', type: 'daily', title: 'Scholar\'s Path', description: 'Learning to read', reward: 10, xp: 15, status: 'active' },
                    { id: 'o1', assignedTo: 'Olive', category: 'Personal', type: 'daily', title: 'Potty Scout', description: 'Successful potty trip', reward: 5, xp: 10, status: 'active' },
                    { id: 'o2', assignedTo: 'Olive', category: 'Personal', type: 'daily', title: 'Pajama Hunter', description: 'PJs in hamper', reward: 5, xp: 10, status: 'active' },
                    { id: 'o3', assignedTo: 'Olive', category: 'Personal', type: 'daily', title: 'Name Writer', description: 'Practice writing O-L-I-V-E', reward: 10, xp: 15, status: 'active' },
                    { id: 'f1', assignedTo: 'Family', category: 'Gardening', type: 'daily', title: 'Seedling Guardians', description: 'Water garden seeds', reward: 10, xp: 15, status: 'active' },
                    { id: 'f2', assignedTo: 'Family', category: 'Personal', type: 'daily', title: 'Bedtime Lore', description: 'Read to kids', reward: 15, xp: 20, status: 'active' },
                    { id: 'f3', assignedTo: 'Family', category: 'Personal', type: 'weekly', title: 'Summit Seekers', description: 'Family hike (2x/mo)', reward: 100, xp: 200, status: 'active' },
                    { id: 'f_v', assignedTo: 'Family', category: 'Finance', type: 'epic', title: 'Brown Family Vault', description: 'Save $1,500 Monthly', reward: 2000, xp: 4000, currentValue: 0, targetValue: 1500, unit: '$', resetsMonthly: true }
                ];
            });

            const [reminders, setReminders] = useState(() => {
                const saved = localStorage.getItem('familyReminders');
                return saved ? JSON.parse(saved) : [];
            });

            const [claimedBonuses, setClaimedBonuses] = useState(() => {
                const saved = localStorage.getItem('claimedBonuses');
                return saved ? JSON.parse(saved) : { rooms: [], sanctuary: false };
            });

            const [rewards, setRewards] = useState(() => {
                const saved = localStorage.getItem('familyRewardsStore');
                if (saved) return JSON.parse(saved);
                return {
                    Family: [
                        { label: 'Bouncy Place Expedition', cost: 1000, rarity: 'Legendary' },
                        { label: 'Astronaut Place Expedition', cost: 1000, rarity: 'Legendary' }
                    ],
                    Eric: [{ label: 'Smart Home Gadget', cost: 400, rarity: 'Epic' }],
                    Catie: [
                        { label: 'Bookstore Trip', cost: 100, rarity: 'Rare' },
                        { label: 'Fine Bottle of Wine', cost: 400, rarity: 'Epic' },
                        { label: 'New Cute Outfit', cost: 1000, rarity: 'Legendary' }
                    ],
                    Rory: [
                        { label: 'Piece of Candy', cost: 10, rarity: 'Common' },
                        { label: '15 Min Screen Time', cost: 25, rarity: 'Unusual' },
                        { label: '$5 Toy Chest', cost: 100, rarity: 'Rare' }
                    ],
                    Olive: [
                        { label: 'Piece of Candy', cost: 10, rarity: 'Common' },
                        { label: '15 Min Screen Time', cost: 25, rarity: 'Unusual' },
                        { label: '$5 Toy Chest', cost: 100, rarity: 'Rare' }
                    ]
                };
            });

            const [menu, setMenu] = useState(() => {
                const saved = localStorage.getItem('familyMenu');
                return saved ? JSON.parse(saved) : ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"].map(d => ({ day: d, meal: 'TBD' }));
            });

            const [newQuest, setNewQuest] = useState({ title: '', description: '', type: 'daily', assignedTo: 'Family', category: 'Personal', resetsMonthly: false });
            const [newCleaning, setNewCleaning] = useState({ title: '', room: 'Kitchen', type: 'daily' });
            const [newReward, setNewReward] = useState({ label: '', rarity: 'Common', owner: 'Family' });
            const [newBounty, setNewBounty] = useState("");

            useEffect(() => {
                localStorage.setItem('familyXP', familyXP);
                localStorage.setItem('familyGold', familyGold);
                localStorage.setItem('familyMembers', JSON.stringify(members));
                localStorage.setItem('familyQuests', JSON.stringify(quests));
                localStorage.setItem('familyMenu', JSON.stringify(menu));
                localStorage.setItem('familyRewardsStore', JSON.stringify(rewards));
                localStorage.setItem('claimedBonuses', JSON.stringify(claimedBonuses));
                localStorage.setItem('familyReminders', JSON.stringify(reminders));
            }, [familyXP, familyGold, members, quests, menu, rewards, claimedBonuses, reminders]);

            const completeQuest = (id) => {
                const quest = quests.find(q => q.id === id);
                if (!quest || quest.status === 'completed') return;
                if (quest.assignedTo === 'Family') setFamilyGold(prev => prev + quest.reward);
                else setMembers(prev => prev.map(m => m.id === quest.assignedTo ? { ...m, gp: m.gp + quest.reward } : m));
                setFamilyXP(prev => prev + quest.xp);
                setQuests(prev => prev.map(q => q.id === id ? { ...q, status: 'completed' } : q));
            };

            const completeReminder = (id) => {
                const reminder = reminders.find(r => r.id === id);
                if (!reminder || reminder.status === 'completed') return;
                setReminders(prev => prev.map(r => r.id === id ? { ...r, status: 'completed' } : r));
                setFamilyGold(prev => prev + 10);
                setFamilyXP(prev => prev + 10);
            };

            const claimRoomBonus = (room) => {
                if (claimedBonuses.rooms.includes(room)) return;
                setFamilyGold(prev => prev + 50);
                setFamilyXP(prev => prev + 100);
                setClaimedBonuses(prev => ({ ...prev, rooms: [...prev.rooms, room] }));
            };

            const claimSanctuaryBonus = () => {
                if (claimedBonuses.sanctuary) return;
                setFamilyGold(prev => prev + 500);
                setFamilyXP(prev => prev + 1000);
                setClaimedBonuses(prev => ({ ...prev, sanctuary: true }));
            };

            const monthlyReset = () => {
                setQuests(prev => prev.map(q => {
                    if (q.category === 'Cleaning') return { ...q, status: 'active' };
                    if (q.resetsMonthly) return { ...q, status: 'active', currentValue: 0 };
                    return q;
                }));
                setClaimedBonuses({ rooms: [], sanctuary: false });
            };

            const updateEpicProgress = (id, amount) => {
                setQuests(prev => prev.map(q => {
                    if (q.id === id && q.type === 'epic') {
                        const newVal = Math.min(q.currentValue + Number(amount), q.targetValue);
                        if (newVal >= q.targetValue && q.currentValue < q.targetValue) {
                            if (q.assignedTo === 'Family') setFamilyGold(prev => prev + q.reward);
                            else setMembers(prev => prev.map(m => m.id === quest.assignedTo ? { ...m, gp: m.gp + quest.reward } : m));
                            setFamilyXP(prev => prev + q.xp);
                        }
                        return { ...q, currentValue: newVal };
                    }
                    return q;
                }));
            };

            const addNewQuestAction = (e) => {
                e.preventDefault();
                if (!newQuest.title) return;
                const quest = {
                    ...newQuest, id: Date.now(), status: 'active',
                    currentValue: newQuest.type === 'epic' ? 0 : undefined,
                    targetValue: newQuest.type === 'epic' ? 100 : undefined,
                    unit: newQuest.type === 'epic' ? 'pts' : undefined,
                    reward: newQuest.type === 'daily' ? 10 : (newQuest.type === 'epic' ? 500 : 50),
                    xp: newQuest.type === 'daily' ? 20 : (newQuest.type === 'epic' ? 1000 : 100)
                };
                setQuests([...quests, quest]);
                setNewQuest({ title: '', description: '', type: 'daily', assignedTo: 'Family', category: 'Personal', resetsMonthly: false });
            };

            const addNewCleaningAction = (e) => {
                e.preventDefault();
                if (!newCleaning.title) return;
                const freqMap = { daily: 'D', weekly: 'W', monthly: 'M' };
                const quest = {
                    id: Date.now(), assignedTo: 'Family', category: 'Cleaning', room: newCleaning.room,
                    type: newCleaning.type, title: newCleaning.title, description: freqMap[newCleaning.type],
                    reward: newCleaning.type === 'daily' ? 5 : (newCleaning.type === 'weekly' ? 20 : 100),
                    xp: newCleaning.type === 'daily' ? 5 : (newCleaning.type === 'weekly' ? 30 : 200),
                    status: 'active'
                };
                setQuests([...quests, quest]);
                setNewCleaning({ title: '', room: 'Kitchen', type: 'daily' });
            };

            const addNewRewardAction = (e) => {
                e.preventDefault();
                if (!newReward.label) return;
                const cost = TIER_COSTS[newReward.rarity];
                const updatedRewards = { ...rewards };
                updatedRewards[newReward.owner] = [...(updatedRewards[newReward.owner] || []), { label: newReward.label, cost, rarity: newReward.rarity }];
                setRewards(updatedRewards);
                setNewReward({ label: '', rarity: 'Common', owner: 'Family' });
            };

            const addNewBountyAction = (e) => {
                e.preventDefault();
                if (!newBounty) return;
                setReminders([...reminders, { id: Date.now(), text: newBounty, status: 'active' }]);
                setNewBounty("");
            };

            const deleteQuest = (id) => setQuests(quests.filter(q => q.id !== id));
            const deleteReward = (owner, label) => {
                const updatedRewards = { ...rewards };
                updatedRewards[owner] = updatedRewards[owner].filter(r => r.label !== label);
                setRewards(updatedRewards);
            };
            const deleteBounty = (id) => setReminders(reminders.filter(r => r.id !== id));

            const updateMeal = (idx, val) => { const nm = [...menu]; nm[idx].meal = val; setMenu(nm); };

            const cleaningQuests = quests.filter(q => q.category === 'Cleaning');
            const globalCleanPercent = cleaningQuests.length > 0 ? Math.round((cleaningQuests.filter(q => q.status === 'completed').length / cleaningQuests.length) * 100) : 0;
            
            const filteredQuests = quests.filter(q => (q.category !== 'Cleaning' && q.type !== 'epic' && (activeFilter === 'All' ? true : q.assignedTo === activeFilter)));
            const filteredEpics = quests.filter(q => q.type === 'epic' && (activeFilter === 'All' ? true : q.assignedTo === activeFilter));

            const getRarityColor = (r) => {
                switch(r) {
                    case 'Common': return 'text-zinc-500';
                    case 'Unusual': return 'text-emerald-500';
                    case 'Rare': return 'text-blue-500';
                    case 'Epic': return 'text-purple-500';
                    case 'Legendary': return 'text-amber-500 font-bold';
                    case 'Mythic': return 'text-red-500 font-bold italic';
                    default: return 'text-zinc-500';
                }
            };

            return (
                <div className={`min-h-screen transition-colors duration-700 p-4 md:p-8`}>
                    <div className="max-w-6xl mx-auto">
                        
                        <header className="flex flex-col mb-10 gap-6">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div className="space-y-1">
                                    <h1 className="rpg-title text-2xl md:text-3xl font-bold flex items-center gap-4 text-white">
                                        <Icon name="Crown" className="text-white opacity-80" size={32} /> 
                                        <span>Brown Family Guild Hall</span>
                                    </h1>
                                    <div className="flex items-center gap-3">
                                        <div className="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Level {Math.floor(familyXP/1000)}</div>
                                        <div className="w-48 skyrim-progress-bg">
                                            <div className="skyrim-progress-fill" style={{ width: `${(familyXP % 1000) / 10}%` }}></div>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4 w-full md:w-auto">
                                    <div className="flex-1 md:flex-initial flex flex-col items-end">
                                        <span className="text-[10px] font-bold text-zinc-500 uppercase">Treasury</span>
                                        <div className="flex items-center gap-2 text-amber-500 font-bold">
                                            <Icon name="Coins" size={16} />
                                            <span>{familyGold} GP</span>
                                        </div>
                                    </div>
                                    <button onClick={() => setIsMeetingMode(!isMeetingMode)} className={`px-5 py-2 text-[10px] font-bold uppercase tracking-[0.2em] transition-all border ${isMeetingMode ? 'border-amber-500 text-amber-500' : 'border-zinc-700 text-zinc-400 hover:text-white hover:border-white'}`}>
                                        {isMeetingMode ? 'End Council' : 'Strategic Planning'}
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap gap-4 w-full skyrim-border-bottom pb-6">
                                <button 
                                    onClick={() => setActiveFilter('All')} 
                                    className={`char-card p-3 rounded-none border transition-all min-w-[100px] flex flex-col items-center justify-center ${activeFilter === 'All' ? 'active' : ''}`}
                                >
                                    <Icon name="LayoutGrid" className="mb-1 text-zinc-400" size={20} />
                                    <span className="text-[10px] font-bold uppercase tracking-widest">General</span>
                                </button>
                                {members.map(m => (
                                    <button 
                                        key={m.id} 
                                        onClick={() => setActiveFilter(m.id)} 
                                        className={`char-card flex-1 min-w-[140px] p-4 rounded-none border transition-all text-left ${activeFilter === m.id ? 'active' : ''}`}
                                    >
                                        <div className="flex items-center gap-3 mb-2">
                                            <Avatar id={m.id} />
                                            <div>
                                                <span className="font-bold text-xs block leading-tight text-white uppercase tracking-wider">{m.name}</span>
                                                <span className="text-[9px] uppercase font-bold text-zinc-500">{m.class}</span>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-1 text-amber-500 font-bold text-sm">
                                            <Icon name="Coins" size={12} /> <span>{m.gp}</span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-10">
                            <div className="lg:col-span-2 space-y-12">
                                
                                {isMeetingMode && (
                                    <div className="flex flex-col gap-6 fade-enter">
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <section className="architect-card p-6 shadow-2xl flex flex-col text-white">
                                                <h2 className="text-[10px] font-bold mb-4 flex items-center gap-2 text-white uppercase tracking-widest">Missions</h2>
                                                <form onSubmit={addNewQuestAction} className="space-y-3 flex-1 flex flex-col">
                                                    <input className="w-full bg-black/40 border border-zinc-800 p-2 text-xs" placeholder="Task name..." value={newQuest.title} onChange={e => setNewQuest({...newQuest, title: e.target.value})}/>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newQuest.assignedTo} onChange={e => setNewQuest({...newQuest, assignedTo: e.target.value})}>
                                                        <option value="Family">Family</option>{members.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                                    </select>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newQuest.type} onChange={e => setNewQuest({...newQuest, type: e.target.value})}>
                                                        <option value="daily">Daily Bounty</option><option value="weekly">Weekly Quest</option><option value="epic">Epic Campaign</option>
                                                    </select>
                                                    <label className="flex items-center gap-2 text-[9px] uppercase font-bold text-zinc-500 cursor-pointer">
                                                        <input type="checkbox" checked={newQuest.resetsMonthly} onChange={e => setNewQuest({...newQuest, resetsMonthly: e.target.checked})} /> Resets Monthly?
                                                    </label>
                                                    <button type="submit" className="w-full border border-white text-white font-bold py-2 text-[10px] uppercase hover:bg-white hover:text-black">Summon</button>
                                                </form>
                                            </section>

                                            <section className="architect-card p-6 shadow-2xl flex flex-col text-white">
                                                <h2 className="text-[10px] font-bold mb-4 flex items-center gap-2 text-white uppercase tracking-widest">Sanctuary</h2>
                                                <form onSubmit={addNewCleaningAction} className="space-y-3 flex-1 flex flex-col">
                                                    <input className="w-full bg-black/40 border border-zinc-800 p-2 text-xs" placeholder="Clean task..." value={newCleaning.title} onChange={e => setNewCleaning({...newCleaning, title: e.target.value})}/>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newCleaning.room} onChange={e => setNewCleaning({...newCleaning, room: e.target.value})}>
                                                        {rooms.map(r => <option key={r} value={r}>{r}</option>)}
                                                    </select>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newCleaning.type} onChange={e => setNewCleaning({...newCleaning, type: e.target.value})}>
                                                        <option value="daily">Daily (D)</option><option value="weekly">Weekly (W)</option><option value="monthly">Monthly (M)</option>
                                                    </select>
                                                    <button type="submit" className="w-full border border-white text-white font-bold py-2 text-[10px] uppercase hover:bg-white hover:text-black">Cast</button>
                                                    <button type="button" onClick={monthlyReset} className="w-full border border-red-900 text-red-500 py-1 text-[9px] uppercase">Reset All</button>
                                                </form>
                                            </section>

                                            <section className="architect-card p-6 shadow-2xl flex flex-col text-white">
                                                <h2 className="text-[10px] font-bold mb-4 flex items-center gap-2 text-white uppercase tracking-widest">Treasury</h2>
                                                <form onSubmit={addNewRewardAction} className="space-y-3 flex-1 flex flex-col">
                                                    <input className="w-full bg-black/40 border border-zinc-800 p-2 text-xs" placeholder="Reward name..." value={newReward.label} onChange={e => setNewReward({...newReward, label: e.target.value})}/>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newReward.owner} onChange={e => setNewReward({...newReward, owner: e.target.value})}>
                                                        <option value="Family">Vault</option>{members.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                                    </select>
                                                    <select className="w-full border border-zinc-800 p-2 text-xs" value={newReward.rarity} onChange={e => setNewReward({...newReward, rarity: e.target.value})}>
                                                        {Object.keys(TIER_COSTS).map(t => <option key={t} value={t}>{t} ({TIER_COSTS[t]} GP)</option>)}
                                                    </select>
                                                    <button type="submit" className="w-full border border-white text-white font-bold py-2 text-[10px] uppercase hover:bg-white hover:text-black">Mint</button>
                                                </form>
                                            </section>
                                        </div>
                                        <section className="architect-card p-4 text-white">
                                            <form onSubmit={addNewBountyAction} className="flex gap-4 items-center">
                                                <span className="text-[10px] uppercase font-bold text-zinc-500 whitespace-nowrap">Add Bounty:</span>
                                                <input className="flex-1 bg-black/40 border border-zinc-800 p-2 text-xs" placeholder="Quick to-do..." value={newBounty} onChange={e => setNewBounty(e.target.value)}/>
                                                <button type="submit" className="border border-purple-500 text-purple-400 px-6 py-2 text-[10px] uppercase hover:bg-purple-500 hover:text-white">Post</button>
                                            </form>
                                        </section>
                                    </div>
                                )}

                                {/* LEGENDARY CAMPAIGNS */}
                                <section className="space-y-6">
                                    <h2 className="rpg-title text-xl font-bold flex items-center gap-3 text-white uppercase tracking-widest">
                                        <span className="opacity-40">—</span> Legendary Campaigns <span className="opacity-40">—</span>
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {filteredEpics.map(q => {
                                            const percent = Math.min(Math.round((q.currentValue / q.targetValue) * 100), 100);
                                            return (
                                                <div key={q.id} className="p-6 border border-zinc-800 bg-black/40 shadow-inner group">
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div>
                                                            <h3 className="font-bold text-sm text-white uppercase tracking-wider">{q.title}</h3>
                                                            <div className="flex items-center gap-2 mt-1">
                                                                <span className="text-[9px] font-bold text-zinc-500 uppercase tracking-tighter">{q.assignedTo}</span>
                                                                {q.resetsMonthly && <span className="text-[8px] border border-amber-900 text-amber-700 px-1 uppercase">Monthly</span>}
                                                            </div>
                                                        </div>
                                                        <span className="text-xs font-bold text-zinc-400">{q.currentValue}/{q.targetValue} {q.unit}</span>
                                                    </div>
                                                    <div className="skyrim-progress-bg mb-6">
                                                        <div className="skyrim-progress-fill amber" style={{ width: `${percent}%` }}></div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => updateEpicProgress(q.id, 1)} className="flex-1 py-2 border border-zinc-800 text-[9px] uppercase font-bold hover:border-zinc-500">+1</button>
                                                        <button onClick={() => updateEpicProgress(q.id, 10)} className="px-4 py-2 border border-zinc-800 text-[9px] uppercase font-bold hover:border-zinc-500">+10</button>
                                                        {isMeetingMode && <button onClick={() => deleteQuest(q.id)} className="p-2 text-red-900 hover:text-red-500"><Icon name="Trash2" size={14}/></button>}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>

                                {/* SANCTUARY MAINTENANCE - COMPACTED FURTHER */}
                                <section className="space-y-6">
                                    <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                        <h2 className="rpg-title text-xl font-bold flex items-center gap-3 text-white uppercase tracking-widest">
                                            <span className="opacity-40">—</span> Sanctuary <span className="opacity-40">—</span>
                                        </h2>
                                        <div className="text-right flex flex-col items-end">
                                            <span className="text-[10px] font-bold text-zinc-500 uppercase">Clearance: {globalCleanPercent}%</span>
                                            <div className="w-48 skyrim-progress-bg mt-1">
                                                <div className="skyrim-progress-fill amber" style={{ width: `${globalCleanPercent}%` }}></div>
                                            </div>
                                            {globalCleanPercent === 100 && !claimedBonuses.sanctuary && (
                                                <button onClick={claimSanctuaryBonus} className="mt-2 text-amber-500 text-[10px] font-bold border border-amber-500 px-4 py-1 animate-pulse uppercase tracking-widest">Claim Sanctuary Clear Bonus</button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="max-h-[250px] overflow-y-auto pr-4 custom-scrollbar">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {rooms.map(room => {
                                                const roomQuests = quests.filter(q => q.room === room);
                                                const roomCompleted = roomQuests.filter(q => q.status === 'completed').length;
                                                const roomPercent = roomQuests.length > 0 ? Math.round((roomCompleted / roomQuests.length) * 100) : 0;
                                                const isCleared = roomPercent === 100;
                                                const bonusClaimed = claimedBonuses.rooms.includes(room);

                                                return (
                                                    <div key={room} className={`p-4 border ${isCleared ? 'border-amber-900/50 bg-amber-950/10' : 'border-zinc-800 bg-black/20'} transition-all`}>
                                                        <div className="flex justify-between items-start mb-2">
                                                            <h3 className={`font-bold text-[10px] uppercase tracking-wider ${isCleared ? 'text-amber-500' : 'text-zinc-300'}`}>{room}</h3>
                                                            <span className="text-[9px] font-bold text-zinc-500">{roomPercent}%</span>
                                                        </div>
                                                        <div className="skyrim-progress-bg mb-3">
                                                            <div className={`skyrim-progress-fill ${isCleared ? 'amber' : ''}`} style={{ width: `${roomPercent}%` }}></div>
                                                        </div>
                                                        <div className="space-y-1">
                                                            {roomQuests.map(q => (
                                                                <div key={q.id} className="flex items-center gap-2 text-[9px] group">
                                                                    <button onClick={() => completeQuest(q.id)} className={`p-0.5 border ${q.status === 'completed' ? 'border-amber-500 text-amber-500' : 'border-zinc-700 text-zinc-600 hover:border-zinc-400'}`}><Icon name="Check" size={8} /></button>
                                                                    <span className={`truncate ${q.status === 'completed' ? 'line-through text-zinc-600 font-normal' : 'text-zinc-400 font-medium'}`}>{q.title}</span>
                                                                    {isMeetingMode && <button onClick={() => deleteQuest(q.id)} className="ml-auto opacity-0 group-hover:opacity-100 text-red-900"><Icon name="Trash2" size={10}/></button>}
                                                                </div>
                                                            ))}
                                                        </div>
                                                        {isCleared && !bonusClaimed && (
                                                            <button onClick={() => claimRoomBonus(room)} className="mt-3 w-full border border-amber-700 text-amber-600 text-[8px] font-bold py-1 uppercase tracking-widest hover:bg-amber-700 hover:text-black">Collect Bonus</button>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </section>

                                {/* MISSIONS - COMPACTED FURTHER */}
                                <section className="space-y-6">
                                    <h2 className="rpg-title text-xl font-bold flex items-center gap-3 text-white uppercase tracking-widest">
                                        <span className="opacity-40">—</span> Active Missions <span className="opacity-40">—</span>
                                    </h2>
                                    <div className="max-h-[250px] overflow-y-auto pr-4 custom-scrollbar">
                                        <div className="space-y-2">
                                            {filteredQuests.map(q => (
                                                <div key={q.id} className={`flex items-center justify-between p-4 border ${q.status === 'completed' ? 'border-zinc-900 bg-zinc-950/20' : 'border-zinc-800 bg-black/40'} transition-all`}>
                                                    <div className="flex items-center gap-4">
                                                        <Icon name={q.status === 'completed' ? 'CheckCircle' : 'Zap'} size={18} className={q.status === 'completed' ? 'text-zinc-800' : 'text-zinc-300'} />
                                                        <div>
                                                            <div className="flex items-center gap-3">
                                                                <h3 className={`font-bold text-xs uppercase tracking-wider ${q.status === 'completed' ? 'text-zinc-700' : 'text-white'}`}>{q.title}</h3>
                                                                {isMeetingMode && <button onClick={() => deleteQuest(q.id)} className="text-red-900"><Icon name="Trash2" size={12}/></button>}
                                                            </div>
                                                            <div className="text-[9px] font-bold text-zinc-500 uppercase tracking-widest">{q.assignedTo} • (+{q.reward} GP)</div>
                                                        </div>
                                                    </div>
                                                    {q.status === 'active' && <button onClick={() => completeQuest(q.id)} className="text-[9px] uppercase font-bold border border-zinc-700 px-4 py-2 hover:border-white hover:text-white transition-all">Claim</button>}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </section>

                                {/* BOUNTY BOARD */}
                                <section className="space-y-6">
                                    <h2 className="rpg-title text-xl font-bold flex items-center gap-3 text-white uppercase tracking-widest">
                                        <span className="opacity-40">—</span> Bounties <span className="opacity-40">—</span>
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        {reminders.map(r => (
                                            <div key={r.id} className="flex items-center justify-between p-3 border border-zinc-800 bg-black/20">
                                                <div className="flex items-center gap-3 overflow-hidden">
                                                    <button onClick={() => completeReminder(r.id)} className={`p-1 border transition-all ${r.status === 'completed' ? 'border-zinc-800 text-zinc-800' : 'border-zinc-600 text-zinc-400 hover:border-white hover:text-white'}`}><Icon name="Check" size={10} /></button>
                                                    <span className={`text-[11px] truncate uppercase tracking-wide ${r.status === 'completed' ? 'text-zinc-700 font-normal' : 'text-zinc-300 font-medium'}`}>{r.text}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    {r.status === 'active' && <span className="text-[8px] font-bold text-amber-700">+10G</span>}
                                                    {isMeetingMode && <button onClick={() => deleteBounty(r.id)} className="text-red-900"><Icon name="Trash2" size={12}/></button>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>

                            <div className="space-y-10">
                                {/* RATION PLAN */}
                                <section className="p-8 border border-zinc-800 bg-black/40">
                                    <h2 className="rpg-title text-sm font-bold mb-6 flex items-center gap-3 text-white uppercase tracking-[0.2em]">Ration Plan</h2>
                                    <div className="space-y-5">
                                        {menu.map((m, i) => (
                                            <div key={i} className="flex flex-col gap-1">
                                                <div className="text-[9px] font-bold text-zinc-500 uppercase tracking-widest">{m.day}</div>
                                                {isMeetingMode ? (
                                                    <input className="bg-black/60 border-b border-zinc-800 text-xs py-1 px-2 text-white outline-none focus:border-amber-500" value={m.meal} onChange={e => updateMeal(i, e.target.value)} />
                                                ) : ( <div className="text-xs font-bold truncate tracking-wide text-zinc-300 uppercase">{m.meal || 'TBD'}</div> )}
                                            </div>
                                        ))}
                                    </div>
                                </section>

                                {/* REWARD SHOP - COMPACTED FURTHER */}
                                <section className="p-8 border border-zinc-800 bg-black/60 flex flex-col max-h-[350px]">
                                    <h2 className="rpg-title text-sm font-bold mb-8 flex items-center gap-3 text-white uppercase tracking-[0.2em]">Treasury</h2>
                                    <div className="flex-1 overflow-y-auto pr-2 custom-scrollbar space-y-10">
                                        {Object.entries(rewards).map(([owner, items]) => {
                                            if (activeFilter !== 'All' && activeFilter !== owner) return null;
                                            return (
                                                <div key={owner} className="fade-enter">
                                                    <div className="text-[9px] font-bold text-zinc-500 uppercase tracking-[0.3em] mb-4">{owner === 'Family' ? 'Guild Vault' : owner}</div>
                                                    <div className="space-y-3">
                                                        {items.map(r => (
                                                            <div key={r.label} className="group relative border-b border-zinc-900 pb-3 flex justify-between items-center hover:bg-white/5 transition-all px-2">
                                                                <div>
                                                                    <div className="text-xs font-bold text-white uppercase tracking-wider">{r.label}</div>
                                                                    <div className={`text-[8px] uppercase tracking-[0.2em] mt-0.5 ${getRarityColor(r.rarity)}`}>{r.rarity}</div>
                                                                </div>
                                                                <div className="flex items-center gap-3">
                                                                    <span className="text-amber-500 text-xs font-bold tracking-tighter">{r.cost} GP</span>
                                                                    {isMeetingMode && <button onClick={() => deleteReward(owner, r.label)} className="text-red-900 opacity-0 group-hover:opacity-100"><Icon name="XCircle" size={14}/></button>}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>